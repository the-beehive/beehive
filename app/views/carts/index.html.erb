<h1>Your Cart</h1>

<hr/>

<% if @cart.empty? %>
  <p>You have no items in your cart.  Please add some from the <%= link_to 'store', root_path%>.</p>
<% else %>
  <p><%= link_to "Empty Cart", cart_path("beehiveisyourfriend"), method: :delete %></p>
  <hr/>
<% end %>

<% total = 0 %>

<ul>
<% @cart.each do |id, stuff| %>
  <% product = Product.find_by_id(id) %>
  <li>
    <% product.images.each do |image|%>
      <%= image_tag(image.uploaded_file, :width => 100, :height => 100) %>
    <% end %>
    <p><%= link_to product.name, product %></p>
    <p><%= product.description %></p>
    <p><%= number_to_currency(product.price, unit: "$") %></p>
    <% stuff.each do | thing, value | %>
      <% if thing == "quantity" %>
        <p><%= thing + ": " + value.to_s %></p>
        <% total += value * product.price %>
      <% elsif thing == "design" %>
        <p><%= thing + ": " + value.to_s %></p>
      <% else thing == "source" %>
        <%= image_tag value %>
      <% end %>
    <% end %>
  </li>
  <br/>
<% end %>
<hr/>
Total: <%= number_to_currency(total, unit: "$") %>
</ul>

<% if current_user.phone.nil? ||
      current_user.phone.empty? ||
      current_user.street.nil? ||
      current_user.street.empty? ||
      current_user.city.nil? ||
      current_user.city.empty? ||
      current_user.state.nil? ||
      current_user.state.empty? ||
      current_user.zip.nil? ||
      current_user.zip.empty? ||
      current_user.phone.nil? ||
      current_user.phone.empty?%>
  <%= link_to "Checkout", user_steps_path %>
<% else %>
  <%= link_to "Checkout", carts_checkout_path %>
<% end %>
